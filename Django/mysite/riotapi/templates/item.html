<!DOCTYPE HTML>
<!--
	Escape Velocity by HTML5 UP
	html5up.net | @n33co
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>No Sidebar - Escape Velocity by HTML5 UP</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<!--[if lte IE 8]><script src="assets/js/ie/html5shiv.js"></script><![endif]-->
		<link rel="stylesheet" href="/static/assets/css/item-page.css" />
		<!--[if lte IE 8]><link rel="stylesheet" href="assets/css/ie8.css" /><![endif]-->
		<link rel="stylesheet" href="/static/src/jquery.typeahead.css">

		<!-- Scripts -->

		<script src="/static/assets/js/jquery.min.js"></script>
		<script src="/static/assets/js/jquery.dropotron.min.js"></script>
		<script src="/static/assets/js/skel.min.js"></script>
		<script src="/static/assets/js/skel-viewport.min.js"></script>
		<script src="/static/assets/js/util.js"></script>
		<!--[if lte IE 8]><script src="assets/js/ie/respond.min.js"></script><![endif]-->
		<script src="/static/assets/js/main.js"></script>
		<script src='/static/Chart.js-master/Chart.min.js'></script>
		<script src="/static/src/jquery.typeahead.js"></script>

	</head>
	<body class="no-sidebar">
		<div id="page-wrapper">

			<!-- Header -->
				<div id="header-wrapper" class="wrapper">
					<div id="header">

					<!-- Nav -->
					<nav id="nav">
						<a href="/" class="button style3">Home</a>
						<p id="result-container"></p>

						        	<div style="margin:0 auto; text-align: center; width:50%;" class="typeahead-container">
						            <div style="margin:0 auto; width:50%;"class="typeahead-field">

							            <span style="width:70%;" class="typeahead-query">
							                <input id="q"
							                       name="q"
							                       type="search"
							                       autofocus
							                       autocomplete="off"
							                       style="text-align:center;"
							                       placeholder="Champion or Item Name">
							            </span>
						            </div>
						        </div>
						        <script src="/static/scripts/my-typeahead.js"></script>
					</nav>
						<!-- Logo -->
							<div id="logo">
								<h1 id="champName"></h1>
								<br>
								<img id="itemImage" width="100" height="100"></img>
							</div>

					</div>
				</div>

			<!-- Main -->
				<div class="wrapper style2">
					<center>
						<button value="total" class="button style2" id="totalButton">Overall</button> 
						<button value="NA" class="button style2" id="naButton">NA</button> 
						<button value="KR" class="button style2" id="krButton">KR</button> 
						<button value="EUW" class="button style2" id="euwButton">EUW</button>
						<button value="EUNE" class="button style2" id="euneButton">EUNE</button>  
						<button value="BR" class="button style2" id="brButton">BR</button> 
					</center> <br>
					<div id="main" class="container" id="na">
						<!-- Features -->
							<section id="features">
								<div class="feature-list">
									<div class="row">
										<div class="6u 12u(mobile)">
											<section>
												<h3><center>Pre Patch 5.13</center></h3>
												<center><div id="carryRate511"></div></center>
												<center>
												<div>Carry Rate</div>	
												<div id="totalCarried511">Total Games Carried: </div>
												<div id="totalGames511">Total Games Analyzed: </div>
												Stats:
												<div id="stats511"></div>
												</center></p>
												
											</section>
										</div>
										<div class="6u 12u(mobile)">
											<section>
												<h3><center>Post Patch 5.13</center></h3>
												<center><div id="carryRate514"></div></center>
												<center>
												<div>Carry Rate</div>											
												<div id="totalCarried514">Total Games Carried: </div>
												<div id="totalGames514">Total Games Analyzed: </div>
												Stats:
												<div id="stats514"></div>
												</center></p>
											</section>
										</div>
									</div>
								</div>


							</section>

						<!-- Content -->
							<div id="content">

								<article class="box post">

									<header class="style1">
										<h2>Item Synergy<br class="mobile-hide" />
										</h2>
										<p>Top 5 items built along with this one in carried games from each patch. <br>There may be overlap so anywhere from 5-10 will show up.</p>
									</header>
									<center>
									<div id="champion-item-graph-legend" width="550" height="30">5.11: <img src="/static/images/darkBox.png"><br>	5.14: <img src="/static/images/lightBox.png"></div>
									<div id="champion-item-graph-container" width="550" height="400"><canvas id="champion-item-graph" width="550" height="400"></canvas></div>
									<div id="champion-item-graph-images-container" width="550" height="55"></div>
									</center>
								</article>

								<article class="box post">
									<header class="style1">
										<h2>Champion Synergy<br class="mobile-hide" />
										</h2>
										<p>Top 5 champions from each patch that used this item in carried games. <br>There may be overlap so anywhere from 5-10 will show up.</p>
									</header>
									<center>
									<div id="champion-champion-graph-legend" width="550" height="30">5.11: <img src="/static/images/darkBox.png"><br>	5.14: <img src="/static/images/lightBox.png"></div>
									<div id="champion-champion-graph-container" width="550" height="400"><canvas id="champion-champion-graph" width="550" height="400"></canvas></div>
									<div id="champion-champion-graph-images-container" width="550" height="55"></div>
									</center>
								</article>
							</div>

							<script>
							//countTo library for animating the carry rates
							(function($) {
							    $.fn.countTo = function(options) {
							        // merge the default plugin settings with the custom options
							        options = $.extend({}, $.fn.countTo.defaults, options || {});

							        // how many times to update the value, and how much to increment the value on each update
							        var loops = Math.ceil(options.speed / options.refreshInterval),
							            increment = (options.to - options.from) / loops;

							        return $(this).each(function() {
							            var _this = this,
							                loopCount = 0,
							                value = options.from,
							                interval = setInterval(updateTimer, options.refreshInterval);

							            function updateTimer() {
							                value += increment;
							                loopCount++;
							                $(_this).html(value.toFixed(options.decimals) + "%");

							                if (typeof(options.onUpdate) == 'function') {
							                    options.onUpdate.call(_this, value);
							                }

							                if (loopCount >= loops) {
							                    clearInterval(interval);
							                    value = options.to;

							                    if (typeof(options.onComplete) == 'function') {
							                        options.onComplete.call(_this, value);
							                    }
							                }
							            }
							        });
							    };

							    $.fn.countTo.defaults = {
							        from: 0,  // the number the element should start at
							        to: 100,  // the number the element should end at
							        speed: 1000,  // how long it should take to count between the target numbers
							        refreshInterval: 100,  // how often the element should be updated
							        decimals: 0,  // the number of decimal places to show
							        onUpdate: null,  // callback method for every time the element is updated,
							        onComplete: null,  // callback method for when the element finishes updating
							    };
							})(jQuery);

							function populateStats511(itemId, desc) {
								var div = $("#stats511");
								if(itemId === "1058") //needlessly large rod
									div.html("+80 Ability Power");
								else if(itemId === "3089") //rabadons
									div.html(desc.replace("35%", "30%"));
								else if(itemId === "3157") //zhonyas
									div.html(desc.replace("100", "120"));
								else if(itemId === "3285") { //luden's
									desc = desc.replace("100", "120");
									div.html(desc.replace("10%", "7%"));
								}
								else if(itemId === "3116") {//rylais
									div.html(desc.replace("<active>Single Target:</active> 40% reduction for 1.5 seconds. <br><active>Area of Effect:</active> 40% reduction for 1 seconds<br><active>Damage over Time or Multi-hit:</active> 20% reduction for 1 seconds.<br><active>Summoned Minions:</active> 20% reduction for 1 seconds.", "<active>Single Target:</active> 35% reduction for 1.5 seconds. <br><active>Area of Effect:</active> 15% reduction for 1 seconds<br><active>Damage over Time or Multi-hit:</active> 15% reduction for 1.5 seconds."));
								}
								else if(itemId === "3003") //archangels
									div.html(desc.replace("80", "60"));
								else if(itemId === "3040") //seraphs
									div.html(desc.replace("80", "60"));
								else if(itemId === "3027") { //rod of ages 
									desc = desc.replace("300", "450");
									desc = desc.replace("400", "450");
									div.html(desc.replace("Grants +20 Health, +40 Mana, and +4 Ability Power per stack (max +200 Health, +400 Mana, and +40 Ability Power).", "Grants +20 Health, +20 Mana, and +2 Ability Power per stack (max +200 Health, +200 Mana, and +20 Ability Power)."));
								}
								else if(itemId === "3151") //liandry's
									div.html(desc.replace("80", "50"));
								else if(itemId === "3115") { //nashor's
									desc = desc.replace("40%", "50%");
									div.html(desc.replace("80", "60"));
								}
								else if(itemId === "3152") { //will of the ancients
									desc = desc.replace('+80 Ability Power', "+20% Spell Vamp<br>+80 Ability Power");
									div.html(desc.replace("<unique>UNIQUE Passive:</unique> Your spells and abilities heal you for 15% of the damage dealt, calculated before your target&#39;s resistances.  This effect is reduced to one third for AoE effects.", ""));
								}
								else
									div.html(desc);
							}


							function convertJson(jsonStr) {
								jsonStr = jsonStr.replace(/&quot;/g, "\"");
								jsonStr = jsonStr.replace(/\\&#39;/g, "\'");
								return JSON.parse(jsonStr);
							}
							var curRegion = "total";
							var data = "{{ data }}";
							data = convertJson(data);

							var champDict = "{{ champDict }}";
							champDict = convertJson(champDict);
							var itemDict = "{{ itemDict }}";
							itemDict = convertJson(itemDict);
							var itemId = "{{ itemId }}";

							//data["title"] = data["title"].replace(/&#39;/g, "\'");
							data["name"] = data["name"].replace(/&#39;/g, "\'");

							$("#itemImage").attr("src", "/static/images/small/" + itemId + ".png");
							var desc = data["description"];
							desc = desc.replace(/&lt;/g, "<");
							desc = desc.replace(/&gt;/g, ">");
							populateStats511(itemId, desc);
							$("#stats514").html(desc);
							$("#champName").text(data["name"]);

							function invalidId(id) {
								if(id === itemId) return true;
								id = parseInt(id);
								if(id >= 3340 && id <= 3342) return true; //trinkets
								if(id >= 3361 && id <= 3364) return true; //upgraded trinkets
								if(id >= 1054 && id <= 1056) return true; //doran's
								if(id === 1001) return true; //boots
								if(id >= 1300 && id <= 1341) return true; //new boot enchants
								if(id >= 3250 && id <= 3284) return true; //old boot enchants
								if(id === 3006 || id === 3009 || id === 3111 || id === 3020 || id === 3117 || id === 3047 || id === 3158) return true; //tier 2 boots
								if(id === 2041) return true; // flask
								return false;
							}

							function getTopData(key, curRegion, data) {
								var result = [];
								var dataPoints = [];
								var obj = data["5.11"][curRegion][key];
								for(var id in obj) {
									if(invalidId(id)) continue; // don't care about ourself when it comes to synergy
									if(obj.hasOwnProperty(id)) { // to avoid prototype keys
										dataPoints.push([id, obj[id]]); //store in format [id, count]
									}
								}
								// sort in descending order
								dataPoints.sort(function(a, b) {
									if (a[1] < b[1]) { return 1; } // index 1 because care about counts
							        else if (a[1] == b[1]) { return 0; }
							        else { return -1; }
								});
								dataPoints = dataPoints.slice(0, 5); //get top 5
								for(var i = 0; i < dataPoints.length; i++) {
									if(dataPoints[i][1] !== 0) //make sure games carried isn't 0
										result.push(dataPoints[i][0]); // just want id
								}
								// now to do 5.14
								dataPoints = [];
								obj = data["5.14"][curRegion][key];
								for(var id in obj) {
									if(invalidId(id)) continue; // don't care about ourself or certain items when it comes to synergy
									if(obj.hasOwnProperty(id)) { // to avoid prototype keys
										dataPoints.push([id, obj[id]]); //store in format [id, count]
									}
								}
								// sort in descending order
								dataPoints.sort(function(a, b) {
									if (a[1] < b[1]) { return 1; } // index 1 because care about counts
							        else if (a[1] == b[1]) { return 0; }
							        else { return -1; }
								});
								dataPoints = dataPoints.slice(0, 5); //get top 5
								for(var i = 0; i < dataPoints.length; i++) {
									if(result.indexOf(dataPoints[i][0]) < 0 && dataPoints[i][1] !== 0) // make sure isn't already in result and games carried isn't 0
										result.push(dataPoints[i][0]); // just want id
								}

								return result;

							}

							function format(floatVar) {
								floatVar = floatVar.toFixed(2);
								return floatVar.toString();
							}

							function renderRegion(curRegion) {
								if(curRegion !== "total") curRegion = curRegion.toUpperCase();
								data511 = data["5.11"][curRegion];
								data514 = data["5.14"][curRegion];

						        
								var carryRate511 = (data511["gamesCarried"] / data511["gamesBuilt"] * 100).toFixed(2);
								if(isNaN(carryRate511)) carryRate511 = 0;
								$('#carryRate511').countTo({
						            from: 0.00,
						            to: carryRate511,
						            speed: 800,
						            decimals: 2,
						            refreshInterval: 50,
						            onComplete: function(value) {
						                //console.debug(this);
						            }
						        });
								var carryRate514 = (data514["gamesCarried"] / data514["gamesBuilt"] * 100).toFixed(2);
								if(isNaN(carryRate514)) carryRate514 = 0;
								//$("#carryRate511").text(carryRate511.toString() + "%");
								//$("#carryRate514").text(carryRate514.toString() + "%");
								$('#carryRate514').countTo({
						            from: 0.00,
						            to: carryRate514,
						            speed: 800,
						            decimals: 2,
						            refreshInterval: 50,
						            onComplete: function(value) {
						                //console.debug(this);
						            }
						        });

								$("#totalCarried511").text("Games Carried: " + data511["gamesCarried"]);
								$("#totalGames511").text("Games Played: " + data511["gamesBuilt"]);

								$("#totalCarried514").text("Games Carried: " + data514["gamesCarried"]);
								$("#totalGames514").text("Games Played: " + data514["gamesBuilt"]);

								var items = getTopData("items", curRegion, data); // holds strings of the ids
								var champs = getTopData("champs", curRegion, data);

								if(items.length === 0) {
									$("#champion-item-graph-container").text("0 games carried :(");
									$("#champion-item-graph-container").css("font-size", "30px");
									$("#champion-item-graph-container").css("font-weight", "Bold");
									$("#champion-item-graph-legend").css("display", "none");
								}
								else {
									var itemLabels = []
									var itemCounts511 = []
									var itemCounts514 = []
									$("#champion-item-graph-images-container").empty(); // remove old images
									for(var i = 0; i < items.length; i++) {
										itemLabels.push(itemDict[parseInt(items[i])].replace(/&#39;/g, "'"));
										itemCounts511.push(data["5.11"][curRegion]["items"][items[i]]);
										itemCounts514.push(data["5.14"][curRegion]["items"][items[i]]);
										$("#champion-item-graph-images-container").append('<img src="/static/images/small/blank.png" width="10" height="50"><a href="/items/' + items[i] + '"><img class="graphImage" src="/static/images/small/' + items[i] + '.png" width="50" height="50"></a>')
									}

									var itemBarData = {
									    labels : itemLabels,
									    datasets : [
									      {
									        fillColor : "#48A497",
									        strokeColor : "#48A4D1",
									        data : itemCounts511
									      },
									      {
									        fillColor : "rgba(73,188,170,0.4)",
									        strokeColor : "rgba(72,174,209,0.4)",
									        data : itemCounts514
									      }
									    ]
									}
									$("#champion-item-graph").remove(); // remove old graph
									$('#champion-item-graph-container').append('<canvas id="champion-item-graph" width="550" height="400"></canvas>');
									var graph = document.getElementById("champion-item-graph").getContext("2d");
									new Chart(graph).Bar(itemBarData, {
									    scaleShowGridLines: false,
									    barStrokeWidth : 1,
									    barDatasetSpacing : 1, 
									});
								}

								if(champs.length === 0) {
									$("#champion-champion-graph-container").text("0 games carried :(");
									$("#champion-champion-graph-container").css("font-size", "30px");
									$("#champion-champion-graph-container").css("font-weight", "Bold");
									$("#champion-champion-graph-legend").css("display", "none");
								}
								else {
									var champLabels = []
									var champCounts511 = []
									var champCounts514 = []
									$("#champion-champion-graph-images-container").empty(); // remove old images
									for(var i = 0; i < champs.length; i++) {
										champLabels.push(champDict[parseInt(champs[i])].replace(/&#39;/g, "'"));
										champCounts511.push(data["5.11"][curRegion]["champs"][champs[i]]);
										champCounts514.push(data["5.14"][curRegion]["champs"][champs[i]]); // ghetto padding since I'm tired of fighting css
										$("#champion-champion-graph-images-container").append('<img src="/static/images/small/blank.png" width="10" height="50"><a href="/champions/' + champs[i] + '"><img src="/static/images/small/' + champs[i] + '.png" width="50" height="50"></a>');
									}
									//$("#champion-champion-graph-images-container").append('<span class="stretch"></span>'); // for spacing out images
									var champBarData = {
									    labels : champLabels,
									    datasets : [
									      {
									        fillColor : "#48A497",
									        strokeColor : "#48A4D1",
									        data : champCounts511
									      },
									      {
									        fillColor : "rgba(73,188,170,0.4)",
									        strokeColor : "rgba(72,174,209,0.4)",
									        data : champCounts514
									      }
									    ]
									}
									$("#champion-champion-graph").remove(); // remove old graph
									$('#champion-champion-graph-container').append('<canvas id="champion-champion-graph" width="550" height="400"></canvas>');
									var graph = document.getElementById("champion-champion-graph").getContext("2d");
									var chart = new Chart(graph).Bar(champBarData, {
									    scaleShowGridLines: false,
									    barStrokeWidth : 1,
									    barDatasetSpacing : 1, 
									});
								}
							}

							$( ".button.style2" ).click(function(event) {
								var key = event.target.value;
								key = key.toLowerCase();
								$("#" + curRegion + "Button").css("background", "none"); // change this color if you want
								$(event.target).css("background-color", "#d96760");
								curRegion = key;
								renderRegion(curRegion);
							});

							//start on overall
							$("#totalButton").trigger("click");
							</script>

					</div>
				</div>

			<!-- Footer -->
				<div id="footer-wrapper" class="wrapper">
					
					<div id="copyright">
						<ul>
							<li>&copy; Ryanblob, Silverqe.</li><li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
						</ul>
					</div>
				</div>

		</div>

	</body>
</html>